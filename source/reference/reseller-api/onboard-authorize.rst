Onboard and Authorize
=====================
.. api-name:: Reseller API
   :version: 2

.. warning::
   This API is currently in development and not available yet.

.. endpoint::
   :method: POST
   :url: https://api.mollie.com/v2/reseller/boarding

.. authentication::
   :api_keys: true
   :oauth: false

Partners that wish to create accounts at Mollie for their customers, can do so via the **Onboard and Authorize API**.

Any accounts created this way will be eligible for kickback on any processed payments and your customer can allow your
OAuth application access to his or her account at Mollie.

How does it work?
-----------------

Using the Onboard and Authorize API, you can submit any information you already have on the organization. Mollie will then
provide you with a pre-filled registration form for your customer. Your customer can review and amend the information
you send, set a password and grant access to your OAuth application. At this point, Mollie will create an Organization
for the customer.

The customer will then come back to your application or service via the :doc:`OAuth authorization flow</oauth/overview>`.

Once the customer is connected, the organization will appear in the List Customers API.

Authentication
--------------

The API call to create the organization should be authenticated with a **Personal access token**. Once your customer has
created the organization and granted you access, you will receive an *auth code* which you can then exchange for an
**access token** which is valid for the app identified with the ``client_id`` parameter.

The access token will have the :doc:`permissions </oauth/permissions>` you requested granted to it. Using this access
token, you can access the new organization with your application.

.. note::
   This API can only be used by Partners. If you want to become a partner of Mollie, please see our
   `website <https://www.mollie.com/en/partners/>`_ and join our Partner Program.

Parameters
----------
.. list-table::
   :widths: auto

   * - ``name``

       .. type:: string
          :required: true

     - Name of the organization

   * - ``email``

       .. type:: string
          :required: true

     - Email address of the organization. This will be used for the confirmation mail.

   * - ``address``

       .. type:: address object
          :required: false

     - The address of the organization.

       .. note::
         All fields are required when there is at least one value set in one of the parameters.

       .. list-table::
          :widths: auto

          * - ``streetAndNumber``

              .. type:: string

            - Street name and house number of the organization.

          * - ``postalCode``

              .. type:: string

            - Postal code of the organization.

          * - ``city``

              .. type:: string

            - City of the organization.

          * - ``country``

              .. type:: string

            - Country of the organization. Provide this in
              `ISO 3166-1 alpha-2 code <https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2>`_.

              For example: ``NL`` ``BE`` ``DE``


   * - ``registrationNumber``

       .. type:: string
          :required: false

     - The registration number of the organization at the (local) chamber of commerce.

   * - ``vatNumber``

       .. type:: string
          :required: false

     - The VAT number of the organization, if based in the European Union. The VAT number will be checked with the
       `VIES <http://ec.europa.eu/taxation_customs/vies/>`_ by Mollie.

   * - ``oauth``

       .. type:: object
          :required: false

     - If you want OAuth permission after the customer in onboarded, you can specify your OAuth details.

       .. list-table::
          :widths: auto

          * - ``client_id``

              .. type:: string
                 :required: true

            - The client ID you receive when :doc:`registering your app </oauth/getting-started>`.

          * - ``scope``

              .. type:: string
                 :required: true

            - A space separated list of permissions your application or service requires. Refer to
              :doc:`Permissions </oauth/permissions>` for more information about the available permissions.

          * - ``state``

              .. type:: string
                 :required: true

            - A random string generated by your application or service to prevent CSRF attacks.

          * - ``redirect_uri``

              .. type:: string
                 :required: true

            - The URL your customer is sent back to once the process has been finished and authorized.

   * - ``locale``

       .. type:: string
          :required: false

     - Sets the language of the form. Provide this parameter in `ISO 15897 <https://en.wikipedia.org/wiki/ISO/IEC_15897>`_
       format.

       Possible values: ``en_US`` ``nl_NL`` ``nl_BE`` ``fr_FR`` ``fr_BE`` ``de_DE`` ``de_AT`` ``de_CH`` ``es_ES`` ``ca_ES``
       ``pt_PT`` ``it_IT`` ``nb_NO`` ``sv_SE`` ``fi_FI`` ``da_DK`` ``is_IS`` ``hu_HU`` ``pl_PL`` ``lv_LV`` ``lt_LT``

Response
--------
``200`` ``application/hal+json; charset=utf-8``

.. list-table::
   :widths: auto

   * - ``resource``

       .. type:: string

     - Indicates the response contains a payment object. Will always contain ``signup-form`` for this endpoint.

   * - ``id``

       .. type:: string

     - The identifier uniquely referring to this signup form. Mollie assigns this identifier at the form creation time.
       For example ``frm_12345678``. Its ID will always be used by Mollie to refer to a certain signup form.

   * - ``mode``

       .. type:: string

     - The mode used to create this signup form. Mode determines whether a signup is real (live mode) or in test.

       Possible values: ``live`` ``test``

   * - ``createdAt``

       .. type:: datetime

     - The form's date and time of creation, in `ISO 8601 <https://en.wikipedia.org/wiki/ISO_8601>`_ format.

   * - ``expiresAt``

       .. type:: datetime

     - The date and time the form will expire, in `ISO 8601 <https://en.wikipedia.org/wiki/ISO_8601>`_ format. On the
       expiry date and time (what is 30 minutes after creation) the form and all it's data will be deleted.

   * - ``name``

       .. type:: string

     - Name of the organization.

   * - ``email``

       .. type:: string

     - E-mail address of the organization.

   * - ``address``

       .. type:: address object
          :required: false

     - Address data of the organization. This object is omitted if you not provided it.

       .. list-table::
          :widths: auto

          * - ``streetAndNumber``

              .. type:: string

            - Street name and house number of the organization.

          * - ``postalCode``

              .. type:: string

            - Postal code of the organization.

          * - ``city``

              .. type:: string

            - City of the organization.

          * - ``country``

              .. type:: string

            - Country of the organization in format:
              `ISO 3166-1 alpha-2 code <https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2>`_.

              For example: ``NL`` ``BE`` ``DE``

   * - ``registrationNumber``

       .. type:: string
          :required: false

     - The registration number of the organization at the (local) chamber of commerce.  This parameter is omitted if you
       not provided it.

   * - ``vatNumber``

       .. type:: string
          :required: false

     - The VAT number of the organization. This parameter is omitted if you not provided it.

   * - ``redirect_uri``

       .. type:: string

     - The URL your customer is sent back to once the process has been finished and authorized.

   * - ``state``

       .. type:: string

     - The random string generated by your application or service to prevent CSRF attacks.

   * - ``_links``

       .. type:: object

     - An object with several URL objects relevant to the payment. Every URL object will contain an ``href`` and a
       ``type`` field.

       .. list-table::
          :widths: auto

          * - ``form``

              .. type:: URL object

            - The URL your customer should visit to complete the signup and authorize process. This is where you should
              redirect the consumer to.

          * - ``documentation``

              .. type:: URL object

            - The URL to the signup form creation endpoint documentation.

Example
-------

Request
^^^^^^^
.. code-block:: bash
   :linenos:

      curl -X POST https://api.mollie.com/v2/organization \
       -H "Authorization: Bearer test_dHar4XY7LxsDOtmnkVtjNVWXLSlXsM" \
       -d "name=Mollie B.V." \
       -d "email=info@mollie.com" \
       -d "client_id=UIbrGN74t13BJO3UdGCn73" \
       -d "scope=payments.read payments.write" \
       -d "state=XudwZnQHfd" \
       -d "redirect_uri=https://webshop.example.org/registration/finish" \
       -d "locale=nl_NL"

Response
^^^^^^^^
.. code-block:: http
   :linenos:

   HTTP/1.1 200 OK
   Content-Type: application/hal+json; charset=utf-8

   {
        "resource": "signup-form",
        "id": "frm_12345678",
        "mode": "test",
        "createdAt": "2018-09-06T16:03:34+00:00",
        "expiresAt": "2018-09-06T16:33:34+00:00",
        "name": "Mollie B.V.",
        "email": "info@mollie.com",
        "address": {
            "streetAndNumber": "Keizersgracht 313",
            "postalCode": "1016 EE",
            "city": "Amsterdam",
            "country": "NL"
        },
        "registrationNumber": "30204462",
        "vatNumber": "NL815839091B01",
        "redirectUrl": "https://webshop.example.org/registration/finish",
        "state": "XudwZnQHfd",
        "_links": {
            "form": {
                "href": "https://api.mollie.com/v2/organizations/signup-form/frm_12345678",
                "type": "text/html"
            },
            "documentation": {
                "href": "https://docs.mollie.com/reference/reseller-api/onboard-authorize",
                "type": "text/html"
            }
        }
   }