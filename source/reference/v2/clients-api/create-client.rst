Create client
=============
.. api-name:: Clients API
   :version: 2

.. endpoint::
   :method: POST
   :url: https://api.mollie.com/v2/clients

.. authentication::
   :api_keys: false
   :organization_access_tokens: true
   :oauth: false

.. note:: This functionality is currently in closed beta. Contact our partner management team if you are interested in
          testing this functionality with us.

Create a new organization that is connected to your :doc:`OAuth application </connect/getting-started>` with the scopes
you requested. You can provide onboarding data that will be pre-filled in the organization.

This API's response will contain a special ``signup`` link where you are expected to redirect your customer. After you
have redirected the customer, an organization will be created, your OAuth application will be authorized automatically
and your customer will be logged in in their (newly created) Mollie Dashboard.

If the organization already exists, no new organization will be created. Instead the OAuth Authorize screen will be
shown to your customer, allowing them to grant the requested authorizations for their existing organization to your
OAuth application.

Finally, your customer will be redirected again to the ``redirect_uri`` you specified when creating your OAuth
application. Then, the normal :doc:`OAuth Authorize flow </reference/oauth2/authorize>` where you exchange an `auth
token` for an `app access token` can be followed.

Once you have received the `app access token` for the organization, you can perform any other API calls on behalf of the
(newly created) organization using OAuth.

Parameters
----------

.. parameter:: oauth
   :type: object
   :condition: required

   The OAuth parameters relevant to your application.

   .. parameter:: clientId
      :type: string
      :condition: required

      The token of the application that you want the new organization to be authorized to.

      Example: ``app_j9Pakf56Ajta6Y65AkdTtAv``.

   .. parameter:: state
      :type: string
      :condition: required

      A random string generated by your app to prevent CSRF attacks. This will be reflected in the ``state`` query
      parameter when the user returns to the ``redirect_uri`` after authorizing your app.

   .. parameter:: approvalPrompt
      :type: string
      :condition: optional

      This parameter can be set to ``force`` to force showing the :doc:`consent screen </connect/getting-started>` to the
      user, even when it is not necessary.

      Possible values: ``auto`` ``force``

   .. parameter:: scope
      :type: string
      :condition: required

      A space separated list of permissions your app requires. Refer to :doc:`Permissions </connect/permissions>` for more
      information about the available scopes.

      .. note:: At a minimum, we recommend you request ``onboarding.read onboarding.write`` and any scopes required for
                orders or payments you want to create. ``onboarding.read`` is required if you wish to follow the onboarding
                progress via the :doc:`/reference/v2/onboarding-api/get-onboarding-status` endpoint
                or `Mollie Dashboard <https://www.mollie.com/dashboard/partners/clients>`_.

.. parameter:: user
   :type: object
   :condition: required

   Personal data of your customer which is required for this endpoint.

   .. parameter:: email
      :type: string
      :condition: required

      The email address of your customer.

   .. parameter:: givenName
      :type: string
      :condition: required

      The given name (first name) of your customer.

   .. parameter:: familyName
      :type: string
      :condition: required

      The family name (surname) of your customer.

   .. parameter:: locale
      :type: string
      :condition: optional

      Allows you to preset the language to be used in the login / authorize flow. When this parameter is omitted, the
      browser language will be used instead. You can provide any ``xx_XX`` format ISO 15897 locale, but the authorize flow
      currently only supports the following languages:

      Possible values: ``en_US`` ``nl_NL`` ``nl_BE`` ``fr_FR`` ``fr_BE`` ``de_DE`` ``es_ES`` ``it_IT``

.. parameter:: organization
   :type: object
   :condition: required

   Data of the organization you want to provide.

   .. parameter:: name
      :type: string
      :condition: optional

      Name of the organization.

   .. parameter:: address
      :type: address object
      :condition: optional

      Address of the organization.

      .. parameter:: streetAndNumber
         :type: string
         :condition: required

         The street name and house number of the organization. If an address is provided, this field is required.

      .. parameter:: postalCode
         :type: string
         :condition: conditional

         The postal code of the organization. If an address is provided, this field is required for countries with a
         postal code system.

      .. parameter:: city
         :type: string
         :condition: required

         The city of the organization. If an address is provided, this field is required.

      .. parameter:: country
         :type: string
         :condition: required

         The country of the address in `ISO 3166-1 alpha-2 <https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2>`_ format.
         This field is always required.

   .. parameter:: registrationNumber
      :type: string
      :condition: optional

      The Chamber of Commerce (or local equivalent) registration number of the organization.

   .. parameter:: vatNumber
      :type: string
      :condition: optional

      The VAT number of the organization, if based in the European Union or the United Kingdom.

      Example: ``NL123456789B01``

Example
-------
.. code-block-selector::
   .. code-block:: bash
      :linenos:

      curl -X POST https://api.mollie.com/v2/clients \
           -H "Content-Type: application/json" \
           -H "Authorization: Bearer access_dHar4XY7LxsDOtmnkVtjNVWXLSlXsM" \
           -d '{
                   "oauth": {
                      "clientId": "app_j9Pakf56Ajta6Y65AkdTtAv",
                      "state": "da82ec0b8a72d8f0",
                      "scope": "onboarding.read onboarding.write payments.read payments.write"
                   },
                   "user": {
                      "email": "norris@chucknorrisfacts.net",
                      "givenName": "Chuck",
                      "familyName": "Norris",
                      "locale": "en_US"
                   },
                   "organization": {
                      "address": {
                         "streetAndNumber": "Keizersgracht 126",
                         "postalCode": "1015 CW",
                         "city": "Amsterdam",
                         "country": "NL"
                      },
                      "name": "Mollie B.V.",
                      "registrationNumber": "30204462",
                      "vatNumber": "NL815839091B01"
                   }
               }'

Response
^^^^^^^^
.. code-block:: none
   :linenos:

   HTTP/1.1 201 Created
   Content-Type: application/hal+json; charset=utf-8

   {
       "id": "csr_vZCnNQsV2UtfXxYifWKWH",
       "resource": "signup-requests",
       "_links": {
           "finalize": {
               "href": "https://my.mollie.com/partner-onboarding/finalize/csr_vZCnNQsV2UtfXxYifWKWH",
               "type": "text/html"
           },
           "documentation": {
               "href": "https://docs.mollie.com/reference/v2/clients-api/create-client",
               "type": "text/html"
           }
       }
   }
